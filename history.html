<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="./favicon.ico">

    <title>歷史紀錄 | 鍛鍊時計</title>

    <!-- Bootstrap core CSS -->      
	<link href="./css/bootstrap-theme.css" rel="stylesheet">	
	<link href="./css/coachTimer.css" rel="stylesheet"> 		
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
	
	
	<script type="text/javascript"> //load Parse
    Parse.initialize("swtRMGFGKXZI4XTZ6MxMASTIhMV1ZArZhAX4A4fj", "dQgwEycp8c0qoTCAqtDbior2xsCnsMKbTaUSq69a");
	</script>
  
    <script>	//load FacebookSDK
      window.fbAsyncInit = function() {
        Parse.FacebookUtils.init({
          appId      : '449939898442125',
          //xfbml      : true,
          //version    : 'v2.0'
        });		
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "http://connect.facebook.net/en_US/all.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    </script>
  
	<script>
  
		$(document).ready(function(){
		
			
		
		});
  
		function getRecord()
		{				
			
			FB.getLoginStatus(function(response) {
			if (response.status === 'connected') {
					messBox("已登入");
					debugger;
					
					FB.api('/me', function(response) {
						$('.userName').html(response.name);						
					});
					
					var user = Parse.User.current();
					
					$("#coinNum").html(user.get("coin"));
					
					var Record = Parse.Object.extend("StepsTraining")
					var query = new Parse.Query(Record);
					query.equalTo("user", user.id);
					query.find({
						success: function(records) {
							messBox("取得紀錄");
							
							records.forEach(function(record)
							{
								console.log(record.createdAt+"\n");
							});
							
							// userPosts contains all of the posts by the current user.
						},
						error: function(records,error)
						{
							messBox("error:" + error.description);
						}
						
						
					});
				
				
			} else if (response.status === 'not_authorized') {
					messBox("FB未授權");
					
					Parse.FacebookUtils.logIn(null, {
					success: function(user) {
						messBox("Parse logIn sucess");
						
				
					},
					error: function(user, error) {					
						messBox("Parse login Fail");
						messBox("error:" + error.description);
					}
					});
					
			} else {
					messBox("未登入FB");																			
			}
			});
									
			
					
		}
	
	
		function messBox(mess)
		{
			$("#messenge").html(mess).fadeIn('slow');							
			setTimeout(
			function()
			{
				$("#messenge").fadeOut('slow');					
				
			},1000
			);
		}
	</script>	
</head>
<body>  
<div id="wrapper">

 <h2><span class="userName"></span> 鍛鍊紀錄 <span id="coinCounter"><img src="./img/Coin.gif">x <span id="coinNum">0</span></span></h2>
 <hr></hr>
  
 <div id="buttonSet">
		<button onclick="getRecord()">XD</button>
 
 </div>
 
 <div id="messenge">
 
 </div>
 
 <div id="footer">
 
	presented by <a href="https://www.facebook.com/pine0113">G.I</a>
	
 </div>

</body>
</html>